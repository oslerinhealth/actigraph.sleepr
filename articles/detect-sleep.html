<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sleep detection from ActiGraph data • actigraph.sleepr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Sleep detection from ActiGraph data">
<meta property="og:description" content="actigraph.sleepr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">actigraph.sleepr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/detect-nonwear.html">Non-wear detection from ActiGraph data</a>
    </li>
    <li>
      <a href="../articles/detect-sleep.html">Sleep detection from ActiGraph data</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="http://github.com/dipetkov/actigraph.sleepr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="detect-sleep_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Sleep detection from ActiGraph data</h1>
            
      
      <small class="dont-index">Source: <a href="http://github.com/dipetkov/actigraph.sleepr/blob/master/vignettes/detect-sleep.Rmd" class="external-link"><code>vignettes/detect-sleep.Rmd</code></a></small>
      <div class="hidden name"><code>detect-sleep.Rmd</code></div>

    </div>

    
    
<p>The <code>actigraph.sleepr</code> package implements three sleep detection algorithms: Sadeh (Sadeh, Sharkey, and Carskadon 1994), Cole-Kripke (Cole et al. 1992) and Tudor-Locke (Tudor-Locke et al. 2014).For illustration let’s use one day of sample data recorded by a GT3X+ monitor.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">file_10s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>
  <span class="st">"extdata"</span>, <span class="st">"GT3XPlus-RawData-Day01.agd"</span>,
  package <span class="op">=</span> <span class="st">"actigraph.sleepr"</span>
<span class="op">)</span></code></pre></div>
<div id="read-agd-files" class="section level3">
<h3 class="hasAnchor">
<a href="#read-agd-files" class="anchor" aria-hidden="true"></a>Read AGD file(s)</h3>
<p>An AGD file is an SQLite database file exported by an ActiGraph device, which contains five tables: settings, data, sleep, awakenings and filters. The sleep and awakenings tables are empty unless the ActiLife tool has been used to analyze the activity counts to detect sleep. See the <a href="http://actigraphcorp.com/support/manuals/actilife-6-manual/" class="external-link">ActiLife 6 User manual</a>.</p>
<p>We can load all five tables as a list using the <code>read_agd_raw</code> function.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># UTC (Coordinated Universal Time) is the default time zone</span>
<span class="va">agdb_10s_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_agd_raw.html">read_agd_raw</a></span><span class="op">(</span><span class="va">file_10s</span>, tz <span class="op">=</span> <span class="st">"UTC"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">agdb_10s_raw</span><span class="op">)</span>
<span class="co">#&gt; [1] "data"       "sleep"      "filters"    "settings"   "awakenings"</span></code></pre></div>
<p>Alternatively, we can use the <code>read_agd</code> function to get the raw activity measurements in a more convenient format: a <code>dplyr</code> data frame (a tibble) of timestamped activity counts, whose attributes are the device settings. However, further manipulations of the tibble using the <code>dplyr</code> verbs (e.g., <code>mutate</code>, <code>inner_join</code>) might drop these non-standard attributes, i.e., the attributes are not always inherited.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">agdb_10s</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_agd.html">read_agd</a></span><span class="op">(</span><span class="va">file_10s</span>, tz <span class="op">=</span> <span class="st">"UTC"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/attributes.html" class="external-link">attributes</a></span><span class="op">(</span><span class="va">agdb_10s</span><span class="op">)</span><span class="op">[</span><span class="fl">10</span><span class="op">:</span><span class="fl">12</span><span class="op">]</span>
<span class="co">#&gt; $devicename</span>
<span class="co">#&gt; [1] "GT3XPlus"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $deviceserial</span>
<span class="co">#&gt; [1] "NEO1DXXXXXXXX"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $deviceversion</span>
<span class="co">#&gt; [1] "2.5.0"</span></code></pre></div>
<p>Since the data is stored in a tibble, we can use the dplyr verbs (mutate, select, filter, summarise, group_by, arrange) to manipulate the data. For example, let’s compute the magnitude of the three-axis counts (axis1 - vertical, axis2 - horizontal, axis3 - lateral).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">agdb_10s</span> <span class="op">&lt;-</span> <span class="va">agdb_10s</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">timestamp</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"axis"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>magnitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">axis1</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="va">axis2</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="va">axis3</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="va">agdb_10s</span>
<span class="co">#&gt; # A tibble: 8,999 x 5</span>
<span class="co">#&gt;    timestamp           axis1 axis2 axis3 magnitude</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2012-06-27 10:54:00   377   397   413      686.</span>
<span class="co">#&gt;  2 2012-06-27 10:54:10   465   816  1225     1544.</span>
<span class="co">#&gt;  3 2012-06-27 10:54:20   505   444   713      980.</span>
<span class="co">#&gt;  4 2012-06-27 10:54:30    73    91   106      158.</span>
<span class="co">#&gt;  5 2012-06-27 10:54:40    45    43   115      131.</span>
<span class="co">#&gt;  6 2012-06-27 10:54:50     0     0     0        0 </span>
<span class="co">#&gt;  7 2012-06-27 10:55:00     0     0     0        0 </span>
<span class="co">#&gt;  8 2012-06-27 10:55:10   207   218   270      404.</span>
<span class="co">#&gt;  9 2012-06-27 10:55:20     0     0     0        0 </span>
<span class="co">#&gt; 10 2012-06-27 10:55:30     0     0     0        0 </span>
<span class="co">#&gt; # … with 8,989 more rows</span></code></pre></div>
</div>
<div id="reintegrate-from-10s-to-60s-epochs" class="section level3">
<h3 class="hasAnchor">
<a href="#reintegrate-from-10s-to-60s-epochs" class="anchor" aria-hidden="true"></a>Reintegrate from 10s to 60s epochs</h3>
<p>The Sadeh and Cole-Kripke algorithms for converting activity measurements into asleep/awake indicators were developed for 60s epochs. If the data is in smaller epochs, we need to collapse or aggregate the epochs. The example data is in 10s epochs.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_activity.html">plot_activity</a></span><span class="op">(</span><span class="va">agdb_10s</span>, <span class="va">axis1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>
    x <span class="op">=</span> <span class="st">""</span>,
    y <span class="op">=</span> <span class="st">"movement (vertical direction)"</span>,
    title <span class="op">=</span> <span class="st">"24 hours of activity measured every 10 seconds"</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_x_datetime</span><span class="op">(</span>date_labels <span class="op">=</span> <span class="st">"%I%p"</span><span class="op">)</span></code></pre></div>
<p><img src="detect-sleep_files/figure-html/unnamed-chunk-5-1.png" width="75%"></p>
<p>So we aggregate the epochs from 10s to 60s by adding the counts for the six consecutive 10s epochs that fall into the same 60s epoch.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Collapse epochs from 10 sec to 60 sec by summing counts</span>
<span class="va">agdb_60s</span> <span class="op">&lt;-</span> <span class="va">agdb_10s</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/collapse_epochs.html">collapse_epochs</a></span><span class="op">(</span><span class="fl">60</span><span class="op">)</span>
<span class="va">agdb_60s</span>
<span class="co">#&gt; # A tibble: 1,500 x 4</span>
<span class="co">#&gt;    timestamp           axis1 axis2 axis3</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;int&gt; &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt;  1 2012-06-27 10:54:00  1465  1791  2572</span>
<span class="co">#&gt;  2 2012-06-27 10:55:00   207   218   270</span>
<span class="co">#&gt;  3 2012-06-27 10:56:00   169   257   270</span>
<span class="co">#&gt;  4 2012-06-27 10:57:00     0     0     0</span>
<span class="co">#&gt;  5 2012-06-27 10:58:00   157   174   248</span>
<span class="co">#&gt;  6 2012-06-27 10:59:00    23    23   279</span>
<span class="co">#&gt;  7 2012-06-27 11:00:00     0     0     0</span>
<span class="co">#&gt;  8 2012-06-27 11:01:00     0     0     0</span>
<span class="co">#&gt;  9 2012-06-27 11:02:00     0     0     0</span>
<span class="co">#&gt; 10 2012-06-27 11:03:00     0     0     0</span>
<span class="co">#&gt; # … with 1,490 more rows</span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_activity.html">plot_activity</a></span><span class="op">(</span><span class="va">agdb_60s</span>, <span class="va">axis1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>
    x <span class="op">=</span> <span class="st">""</span>,
    y <span class="op">=</span> <span class="st">"movement (vertical direction)"</span>,
    title <span class="op">=</span> <span class="st">"24 hours of activity data measured every minute"</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_x_datetime</span><span class="op">(</span>date_labels <span class="op">=</span> <span class="st">"%I%p"</span><span class="op">)</span></code></pre></div>
<p><img src="detect-sleep_files/figure-html/unnamed-chunk-7-1.png" width="75%"></p>
<p>Integration nicely emphasizes a peak of activity just before 6pm.</p>
</div>
<div id="process-a-batch-of-agd-files" class="section level3">
<h3 class="hasAnchor">
<a href="#process-a-batch-of-agd-files" class="anchor" aria-hidden="true"></a>Process a batch of AGD files</h3>
<p>With a few lines of code, we can load each AGD file in a directory, collapse from 10s to 60s and save the integrated activity data.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="http://purrr.tidyverse.org" class="external-link">"purrr"</a></span><span class="op">)</span>

<span class="co"># Construct a path to the directory which contains the raw AGD files</span>
<span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"actigraph.sleepr"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">path</span>, pattern <span class="op">=</span> <span class="st">"*.agd"</span>, full.names  <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>  <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_dfr</a></span><span class="op">(</span>
    <span class="op">~</span> <span class="fu"><a href="../reference/read_agd.html">read_agd</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/collapse_epochs.html">collapse_epochs</a></span><span class="op">(</span><span class="fl">60</span><span class="op">)</span>,
    .id <span class="op">=</span> <span class="st">".filename"</span>
  <span class="op">)</span>
<span class="co">#&gt; # A tibble: 2,940 x 10</span>
<span class="co">#&gt;    .filename timestamp           axis1 axis2 axis3 steps inclineoff</span>
<span class="co">#&gt;    &lt;chr&gt;     &lt;dttm&gt;              &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;      &lt;int&gt;</span>
<span class="co">#&gt;  1 1         2012-04-04 13:29:00   600  1025   891     5          0</span>
<span class="co">#&gt;  2 1         2012-04-04 13:30:00    88   367    74     2         33</span>
<span class="co">#&gt;  3 1         2012-04-04 13:31:00   493   646   622     4         33</span>
<span class="co">#&gt;  4 1         2012-04-04 13:32:00   358   284   174     1         14</span>
<span class="co">#&gt;  5 1         2012-04-04 13:33:00   290   341    77     5         30</span>
<span class="co">#&gt;  6 1         2012-04-04 13:34:00    57   166    23     6         32</span>
<span class="co">#&gt;  7 1         2012-04-04 13:35:00   158   240    40     9         46</span>
<span class="co">#&gt;  8 1         2012-04-04 13:36:00    68   214   102     2         41</span>
<span class="co">#&gt;  9 1         2012-04-04 13:37:00  1500  1562  1252    12         11</span>
<span class="co">#&gt; 10 1         2012-04-04 13:38:00   165   296    59     4          4</span>
<span class="co">#&gt; # … with 2,930 more rows, and 3 more variables: inclinestanding &lt;int&gt;,</span>
<span class="co">#&gt; #   inclinesitting &lt;int&gt;, inclinelying &lt;int&gt;</span></code></pre></div>
</div>
<div id="apply-the-sadeh-algorithm" class="section level3">
<h3 class="hasAnchor">
<a href="#apply-the-sadeh-algorithm" class="anchor" aria-hidden="true"></a>Apply the Sadeh algorithm</h3>
<p>The Sadeh sleep scoring algorithm is primarily used for younger adolescents as the supporting research was performed on children and young adults. It requires 60s epochs and uses an 11-minute window that includes the five previous and five future epochs. The <code>apply_sadeh</code> function implements the algorithm as described in the ActiGraph user manual.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">agdb_sadeh</span> <span class="op">&lt;-</span> <span class="va">agdb_60s</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/apply_sadeh.html">apply_sadeh</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Here are the details. The Sadeh algorithm uses the y-axis (axis 1) counts; epoch counts over 300 are set to 300. The sleep index (SI) is defined as</p>
<pre><code>SI = 7.601 - (0.065 * AVG) - (1.08 * NATS) - (0.056 * SD) - (0.703 * LG)</code></pre>
<p>where at epoch t:</p>
<dl>
<dt>AVG</dt>
<dd>the arithmetic mean (average) of the activity counts in an 11-epoch window centered at t;
</dd>
<dt>NATS</dt>
<dd>the number of epochs in this 11-epoch window which have counts &gt;= 50 and &lt; 100;
</dd>
<dt>SD:</dt>
<dd>the standard deviation of the counts in a 6-epoch window that includes t and the five preceding epochs;
</dd>
<dt>LG</dt>
<dd>the natural (base e) logarithm of the activity at epoch t. To avoid taking the log of 0, we add 1 to the count.
</dd>
</dl>
<p>The time series of activity counts is padded with zeros as necessary, at the beginning and at the end, to compute the three functions AVG, SD, NATS within a rolling window. Finally, the sleep state is awake (W) if the sleep index SI is greater than -4; otherwise the sleep state is asleep (S).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_activity.html">plot_activity</a></span><span class="op">(</span><span class="va">agdb_sadeh</span>, <span class="va">axis1</span>, color <span class="op">=</span> <span class="st">"sleep"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>
    x <span class="op">=</span> <span class="st">""</span>,
    y <span class="op">=</span> <span class="st">"movement (bounded at 300)"</span>,
    title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span>
      <span class="st">"For each epoch, Sadeh infers whether"</span>,
      <span class="st">"the subject is asleep (red) or awake (blue)"</span>
    <span class="op">)</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_x_datetime</span><span class="op">(</span>date_labels <span class="op">=</span> <span class="st">"%I%p"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">guides</span><span class="op">(</span>color <span class="op">=</span> <span class="cn">FALSE</span>, fill <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p><img src="detect-sleep_files/figure-html/unnamed-chunk-10-1.png" width="75%"></p>
</div>
<div id="apply-the-cole-kripke-algorithm" class="section level3">
<h3 class="hasAnchor">
<a href="#apply-the-cole-kripke-algorithm" class="anchor" aria-hidden="true"></a>Apply the Cole-Kripke algorithm</h3>
<p>The Cole-Kripke sleep scoring algorithm is primarily used for adult populations as the supporting research was performed on subjects ranging from 35 to 65 years of age. Like the Sadeh algorithm, it requires 60s epochs and uses a 7-minute window that includes the four previous and two future epochs. The <code>apply_cole_kripke</code> function implements the algorithm as described in the ActiGraph user manual.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">agdb_colekripke</span> <span class="op">&lt;-</span> <span class="va">agdb_60s</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/apply_cole_kripke.html">apply_cole_kripke</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Here are the details. The Cole-Kripke algorithm uses the y-axis (axis 1) counts; first epoch counts are divided by 100 and afterwards any scaled counts over 300 are set to 300. The sleep index (SI) is defined as</p>
<pre><code>.001 * (106 * Epoch_prev4 + 54 * Epoch_prev3 + 58 * Epoch_prev2 + 76 * Epoch_prev1 +
        230 * Epoch +
         74 * Epoch_next1 + 67 * Epoch_next1)</code></pre>
<p>where at epoch t:</p>
<dl>
<dt>Epoch_prev(i)</dt>
<dd>the scaled activity count i epochs before t;
</dd>
<dt>Epoch_next(i)</dt>
<dd>the scaled activity count i epochs after t.
</dd>
</dl>
<p>The time series of activity counts is padded with zeros as necessary, at the beginning and at the end. Finally, the sleep state is awake (W) if the sleep index SI is less than 1; otherwise the sleep state is asleep (S).</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_activity.html">plot_activity</a></span><span class="op">(</span><span class="va">agdb_colekripke</span>, <span class="va">axis1</span>, color <span class="op">=</span> <span class="st">"sleep"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>
    x <span class="op">=</span> <span class="st">""</span>,
    y <span class="op">=</span> <span class="st">"movement (bounded at 300)"</span>,
    title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span>
      <span class="st">"For each epoch, Cole-Kripke infers whether"</span>,
      <span class="st">"the subject is asleep (red) or awake (blue)"</span>
    <span class="op">)</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_x_datetime</span><span class="op">(</span>date_labels <span class="op">=</span> <span class="st">"%I%p"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">guides</span><span class="op">(</span>color <span class="op">=</span> <span class="cn">FALSE</span>, fill <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p><img src="detect-sleep_files/figure-html/unnamed-chunk-12-1.png" width="75%"></p>
<p>What is the agreement between the Sadeh and Cole-Kripke asleep/awake algorithms, on the example dataset?</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">agdb_sadeh</span><span class="op">$</span><span class="va">sleep</span>, <span class="va">agdb_colekripke</span><span class="op">$</span><span class="va">sleep</span><span class="op">)</span>
<span class="co">#&gt;    </span>
<span class="co">#&gt;       S   W</span>
<span class="co">#&gt;   S 881  56</span>
<span class="co">#&gt;   W 114 449</span></code></pre></div>
</div>
<div id="apply-the-tudor-locke-algorithm" class="section level3">
<h3 class="hasAnchor">
<a href="#apply-the-tudor-locke-algorithm" class="anchor" aria-hidden="true"></a>Apply the Tudor-Locke algorithm</h3>
<p>Once each one-minute epoch is labeled as asleep (S) or awake (W), we can use the Tudor-Locke algorithm to detect periods of time in bed and, for each period, to compute sleep quality metrics such as total minutes in bed, total sleep time, number and average length of awakenings, movement and fragmentation indices</p>
<p>The Tudor-Locke algorithm has several parameters:</p>
<dl>
<dt>n_bedtime_start</dt>
<dd>Bedtime definition, in minutes. The default is 5.
</dd>
<dt>n_wake_time_end</dt>
<dd>Wake time definition, in minutes. The default is 10.
</dd>
<dt>min_sleep_period</dt>
<dd>Min sleep period length, in minutes. The default is 160.
</dd>
<dt>max_sleep_period</dt>
<dd>Max sleep period length, in minutes. The default is 1440 (24 hours).
</dd>
<dt>min_nonzero_epochs</dt>
<dd>Min number of epochs with non-zero activity. The default is 0.
</dd>
</dl>
<p>Bedtime is (the first minute of) <code>n_bedtime_start</code> consecutive epochs/minutes labeled 0. Similarly, wake time is (the first minute of) of <code>n_wake_time_end</code> consecutive epochs/minutes labeled 1, after a period of sleep. The time block between bedtime and wake time is one sleep period, if the time elapsed is at least <code>min_sleep_period minutes</code>. There can be multiple sleep periods in 24 hours but a sleep period cannot be longer than <code>max_sleep_period</code> minutes.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">periods_sleep</span> <span class="op">&lt;-</span> <span class="va">agdb_sadeh</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/apply_tudor_locke.html">apply_tudor_locke</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">periods_sleep</span>
<span class="co">#&gt;           in_bed_time        out_bed_time               onset latency</span>
<span class="co">#&gt; 1 2012-06-28 00:03:00 2012-06-28 07:38:00 2012-06-28 00:03:00       0</span>
<span class="co">#&gt;   efficiency duration activity_counts nonzero_epochs total_sleep_time</span>
<span class="co">#&gt; 1   97.14286      455            9126             27              442</span>
<span class="co">#&gt;   wake_after_onset nb_awakenings ave_awakening movement_index</span>
<span class="co">#&gt; 1               13             4          3.25       5.934066</span>
<span class="co">#&gt;   fragmentation_index sleep_fragmentation_index</span>
<span class="co">#&gt; 1                  40                  45.93407</span></code></pre></div>
<p>For each sleep period, the Tudor-Locke algorithm computes several sleep quality measures:</p>
<dl>
<dt>in_bed_time</dt>
<dd>The first minute of the bedtime.
</dd>
<dt>out_bed_time</dt>
<dd>The first minute of wake time.
</dd>
<dt>onset</dt>
<dd>The first minute that the algorithm scores “asleep”. By the definition of Tudor-Locke, the sleep onset occurs with the start of bedtime.
</dd>
<dt>latency</dt>
<dd>The time elapsed between bedtime and sleep onset. By the definition of Tudor-Locke, latency is 0.
</dd>
<dt>duration</dt>
<dd>The duration of the sleep period, in minutes.
</dd>
<dt>efficiency</dt>
<dd>The number of sleep minutes divided by the bedtime minutes.
</dd>
<dt>activity_counts</dt>
<dd>The sum of activity counts for the entire sleep period.
</dd>
<dt>total_sleep_time</dt>
<dd>The number of minutes scored as “asleep” during the sleep period.
</dd>
<dt>wake_after_onset</dt>
<dd>The number of minutes scored as “awake”, minus the sleep latency, during the sleep period.
</dd>
<dt>nb_awakenings</dt>
<dd>The number of awakening episodes.
</dd>
<dt>ave_awakening</dt>
<dd>The average length, in minutes, of all awakening episodes.
</dd>
<dt>movement_index</dt>
<dd>Proportion of awake time out of the total time in bed, in percentages.
</dd>
<dt>fragmentation_index</dt>
<dd>Proportion of one-minute sleep bouts out of the number of sleep bouts of any length, in percentages.
</dd>
<dt>sleep_fragmentation_index</dt>
<dd>The sum of the movement and fragmentation indices.
</dd>
</dl>
<p>Sleep (or any other type of) periods in a time series can be highlighted as rectangles.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_activity_period.html">plot_activity_period</a></span><span class="op">(</span>
  <span class="va">agdb_60s</span>, <span class="va">periods_sleep</span>, <span class="va">axis1</span>,
  <span class="va">in_bed_time</span>, <span class="va">out_bed_time</span>,
  fill <span class="op">=</span> <span class="st">"#AAAAAA"</span>
<span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_x_datetime</span><span class="op">(</span>date_labels <span class="op">=</span> <span class="st">"%I%p"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>
    x <span class="op">=</span> <span class="st">""</span>,
    y <span class="op">=</span> <span class="st">"movement"</span>,
    title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span>
      <span class="st">"Tudor-Locke detects sleep periods in a series of"</span>,
      <span class="st">"sleep-scored epochs (Ws and Ss)\n"</span>,
      <span class="st">"Sleep periods, if any, are highlighted as gray rectangles"</span>
    <span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<p><img src="detect-sleep_files/figure-html/unnamed-chunk-15-1.png" width="75%"></p>
<p>Let’s find the awake periods, which are the complement of the sleep periods.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">periods_awake</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/complement_periods.html">complement_periods</a></span><span class="op">(</span>
  <span class="va">periods_sleep</span>, <span class="va">agdb_sadeh</span>,
  <span class="va">in_bed_time</span>, <span class="va">out_bed_time</span>
<span class="op">)</span>
<span class="va">periods_awake</span>
<span class="co">#&gt; # A tibble: 2 x 3</span>
<span class="co">#&gt;   period_start        period_end          length</span>
<span class="co">#&gt;   &lt;dttm&gt;              &lt;dttm&gt;               &lt;int&gt;</span>
<span class="co">#&gt; 1 2012-06-27 10:54:00 2012-06-28 00:02:00    789</span>
<span class="co">#&gt; 2 2012-06-28 07:39:00 2012-06-28 11:53:00    255</span></code></pre></div>
<p>Let’s combine the epochs and the awake periods. Then we can easily slice the time series by sleep/non-sleep periods.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Let's label the epochs with a `period_id`, which indicates the awake period</span>
<span class="co"># that each epoch falls in. The ids are consecutive integers starting from 1.</span>
<span class="co"># If the epoch is outside an awake period, then `period_id` is NA.</span>
<span class="va">agdb_awake</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/combine_epochs_periods.html">combine_epochs_periods</a></span><span class="op">(</span>
  <span class="va">agdb_sadeh</span>, <span class="va">periods_awake</span>,
  <span class="va">period_start</span>, <span class="va">period_end</span>
<span class="op">)</span>
<span class="va">agdb_awake</span>
<span class="co">#&gt; # A tibble: 1,500 x 7</span>
<span class="co">#&gt;    timestamp           axis1 axis2 axis3 count sleep period_id</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt;</span>
<span class="co">#&gt;  1 2012-06-27 10:54:00  1465  1791  2572   300 W             1</span>
<span class="co">#&gt;  2 2012-06-27 10:55:00   207   218   270   207 W             1</span>
<span class="co">#&gt;  3 2012-06-27 10:56:00   169   257   270   169 W             1</span>
<span class="co">#&gt;  4 2012-06-27 10:57:00     0     0     0     0 W             1</span>
<span class="co">#&gt;  5 2012-06-27 10:58:00   157   174   248   157 W             1</span>
<span class="co">#&gt;  6 2012-06-27 10:59:00    23    23   279    23 W             1</span>
<span class="co">#&gt;  7 2012-06-27 11:00:00     0     0     0     0 S             1</span>
<span class="co">#&gt;  8 2012-06-27 11:01:00     0     0     0     0 S             1</span>
<span class="co">#&gt;  9 2012-06-27 11:02:00     0     0     0     0 S             1</span>
<span class="co">#&gt; 10 2012-06-27 11:03:00     0     0     0     0 S             1</span>
<span class="co">#&gt; # … with 1,490 more rows</span>
<span class="va">agdb_awake</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">period_id</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 3 x 2</span>
<span class="co">#&gt;   period_id     n</span>
<span class="co">#&gt;       &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt; 1         1   789</span>
<span class="co">#&gt; 2         2   255</span>
<span class="co">#&gt; 3        NA   456</span></code></pre></div>
</div>
<div id="references" class="section level3">
<h3 class="hasAnchor">
<a href="#references" class="anchor" aria-hidden="true"></a>References</h3>
<p>Sadeh, Avi, Katherine M Sharkey, and Mary A Carskadon. 1994. “Activity Based Sleep-Wake Identification: An Empirical Test of Methodological Issues.” <em>Sleep</em> 17 (3): 201–7.</p>
<p>Cole, Roger J, Daniel F Kripke, William Gruen, Daniel J Mullaney, and J Christian Gillin. 1992. “Automatic Sleep/Wake Identification from Wrist Activity.” <em>Sleep</em> 15 (5): 461–69.</p>
<p>Tudor-Locke, Catrine, Tiago V. Barreira, John M. Schuna, Emily F. Mire, and Peter T. Katzmarzyk. 2014. “Fully Automated Waist-Worn Accelerometer Algorithm for Detecting Children’s Sleep-Period Time Separate from 24-H Physical Activity or Sedentary Behaviors.” <em>Applied Physiology, Nutrition, and Metabolism</em> 39 (1): 53–57.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Desislava Petkova.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link external-link">pkgdown</a> 1.6.1.9001.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
